<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: A simple scatterplot with SVG</title>
		<script type="text/javascript" src="../d3/d3.v3.js"></script>
		<style type="text/css">
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
		</style>
	</head>
	<body>
		<script type="text/javascript">

			function dynamicData (n) {
				var data = [];
				var xRange = Math.random() * 1000;
				var yRange = Math.random() * 1000;
				var randInt = function (r) {
					return Math.floor(Math.random() * r);
				}
				for (var i = 0; i < n; i++) {
					data.push([randInt(xRange), randInt(yRange)]);
				}
				return data;
			}

			var orig_data = dynamicData(50);
			var orig_max_x = d3.max(orig_data, function x (d) { return d[0]; });
			console.log(orig_max_x);

			var dataset = orig_data.map(function proportion (e) {
					return [e[0] / orig_max_x, e[1]];
					});

			var margin = { top: 20, bottom: 20, left: 40, right: 40 };

			//Width and height
			var w = 500 - margin.left - margin.right;
			var h = 300 - margin.top - margin.bottom;
	
			//Create SVG element
			var svg = d3.select('body').append('svg')
					.attr('width', w + margin.left + margin.right)
					.attr('height', h + margin.bottom + margin.top)
				.append('g')
					.attr('transform',
							'translate(' + margin.left + ',' + margin.top + ')');

			// Data scale
			var xscale = d3.scale.linear()
				.domain([0, d3.max(dataset, function (d) { return d[0]; })])
				.range([0, w]);

			var yscale = d3.scale.linear()
				.domain([0, d3.max(dataset, function (d) { return d[1]; })])
				.range([h, 0]);

			var rscale = d3.scale.linear()
				.domain([0, d3.max(dataset, function (d) { return d[1]; })])
				.range([2, 5])
				.nice();

			// Data points
			svg.selectAll('circle')
				.data(dataset)
			 	.enter()
			 	.append('circle')
			 	.attr('cx', function (d) {
						return xscale(d[0]);
						})
			 	.attr('cy', function (d) {
						return yscale(d[1]);
						})
				.attr('r', function (d) {
						return Math.ceil(rscale(d[1]));
						});

			// Number formatting
			var formatAsPercentage = d3.format('.1%');

			// Labels
			var fontsize = 11;
			svg.selectAll('text').data(dataset).enter().append('text')
				.text(function (d) { return d[0] + ',' +  d[1]; })
				.attr('x', function (d) {
						console.log('x' + ':' + d[0]);
						return xscale(d[0]);
						})
				.attr('y', function (d) {
						console.log('y' + ':' + d[1]);
						return yscale(d[1]);
						})
				.attr('fill', 'red')
				.attr('font-family', 'sans-serif')
				.attr('font-size', fontsize)
				.attr('class', 'label')
				.attr('text-anchor', 'center');

			// Axis
			var xaxis = d3.svg.axis()
				.scale(xscale)
				.ticks(10)
				.orient('bottom')
				.tickFormat(formatAsPercentage);
			var yaxis = d3.svg.axis()
				.scale(yscale)
				.orient('left');

			svg.append('g')
				.attr('class', 'axis')
				.attr('transform', 'translate(0,' + h + ')')
				.call(xaxis);
			svg.append('g')
				.attr('class', 'axis')
				.call(yaxis);

		</script>
	</body>
</html>
